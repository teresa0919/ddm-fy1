<!-- ... 上面保留原 head 部分不變 ... -->

    <select id="sessionSelect">
      <option value="">請選擇誦持時段</option>
      <option value="早課">早課</option>
      <option value="晚課">晚課</option>
    </select>

<!-- ... 其他程式碼不變 ... -->

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
      import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDbYzBhcttD3Dn7QRKOiOM-c3RV-ArMl9I",
        authDomain: "ddm-fy1-8fe29.firebaseapp.com",
        databaseURL: "https://ddm-fy1-8fe29-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "ddm-fy1-8fe29",
        storageBucket: "ddm-fy1-8fe29.appspot.com",
        messagingSenderId: "111333348405",
        appId: "1:111333348405:web:095cbeabb7f67353f40d7c"
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      // 自動偵測現在時間，選擇早課或晚課
      const hour = new Date().getHours();
      const sessionSelect = document.getElementById("sessionSelect");
      sessionSelect.value = hour < 12 ? "早課" : "晚課";

      document.getElementById("submitBtn").addEventListener("click", async () => {
        const nickname = document.getElementById("nickname").value.trim();
        const sutra = document.getElementById("sutraSelect").value === "其他"
          ? document.getElementById("customSutra").value.trim()
          : document.getElementById("sutraSelect").value;
        const count = document.getElementById("count").value;
        const session = document.getElementById("sessionSelect").value;

        if (!nickname || !sutra || !count || !session) {
          alert("請填寫所有欄位！");
          return;
        }

        try {
          localStorage.setItem("nickname", nickname);
          const date = new Date().toISOString().slice(0, 10);
          const checkinRef = ref(db, "checkins/" + date);
          await push(checkinRef, {
            nickname,
            sutra,
            count: Number(count),
            session,
            timestamp: Date.now()
          });

          window.location.href = "success.html";
        } catch (err) {
          alert("打卡失敗：" + err.message);
        }
      });
    </script>

    <script>
      function toggleCustomInput(select) {
        const customInput = document.getElementById('customSutra');
        customInput.style.display = select.value === '其他' ? 'block' : 'none';
      }
      const blessings = [
        "願你法喜充滿，智慧增長。",
        "善念如蓮，清淨自心。",
        "一念清淨，一步光明。",
        "願你持誦一咒，萬善俱圓。",
        "心中有佛，所見皆淨。"
      ];
      document.getElementById("blessing").textContent = blessings[Math.floor(Math.random() * blessings.length)];
    </script>
